
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style media="screen">
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s, .highlight .sa, .highlight .dl {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf, .highlight .fm {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv, .highlight .vm {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .nl {
  color: #f92672;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <style media="print">
      * {
        -webkit-transition:none!important;
        transition:none!important;
      }
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sa, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}
    </style>
    <link href="stylesheets/screen-c9d8fa83.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-953e3353.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-e9bde216.js"></script>

    <script>
      $(function() { setupCodeCopy(); });
    </script>
  </head>

  <body class="index" data-languages="[&quot;python&quot;,&quot;ruby&quot;,&quot;typescript&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo-e75e0729.png" class="logo" alt="" />
        <div class="lang-selector">
              <a href="#" data-language-name="python">python</a>
              <a href="#" data-language-name="ruby">ruby</a>
              <a href="#" data-language-name="typescript">node</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
          </li>
          <li>
            <a href="#registering-as-a-partner" class="toc-h1 toc-link" data-title="Registering as a Partner">Registering as a Partner</a>
          </li>
          <li>
            <a href="#creating-an-application" class="toc-h1 toc-link" data-title="Creating an application">Creating an application</a>
          </li>
          <li>
            <a href="#obtaining-an-access-token" class="toc-h1 toc-link" data-title="Obtaining an Access Token">Obtaining an Access Token</a>
          </li>
          <li>
            <a href="#using-your-access-token-for-api-queries" class="toc-h1 toc-link" data-title="Using your Access Token for API queries">Using your Access Token for API queries</a>
          </li>
          <li>
            <a href="#retrieving-resort-information" class="toc-h1 toc-link" data-title="Retrieving resort information">Retrieving resort information</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#http-request" class="toc-h2 toc-link" data-title="HTTP Request">HTTP Request</a>
                  </li>
                  <li>
                    <a href="#query-parameters" class="toc-h2 toc-link" data-title="Query Parameters">Query Parameters</a>
                  </li>
                  <li>
                    <a href="#response-body" class="toc-h2 toc-link" data-title="Response Body">Response Body</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#building-your-own-widget" class="toc-h1 toc-link" data-title="Building your own widget">Building your own widget</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#package-list" class="toc-h2 toc-link" data-title="Package List">Package List</a>
                  </li>
                  <li>
                    <a href="#age-discounts-list" class="toc-h2 toc-link" data-title="Age Discounts List">Age Discounts List</a>
                  </li>
                  <li>
                    <a href="#seasons-list" class="toc-h2 toc-link" data-title="Seasons List">Seasons List</a>
                  </li>
                  <li>
                    <a href="#availability-data" class="toc-h2 toc-link" data-title="Availability Data">Availability Data</a>
                  </li>
                  <li>
                    <a href="#pricing-data" class="toc-h2 toc-link" data-title="Pricing Data">Pricing Data</a>
                  </li>
                  <li>
                    <a href="#inquiry-creation" class="toc-h2 toc-link" data-title="Inquiry Creation">Inquiry Creation</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#embedding-our-widget" class="toc-h1 toc-link" data-title="Embedding Our Widget">Embedding Our Widget</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#loading-the-widget" class="toc-h2 toc-link" data-title="Loading the widget">Loading the widget</a>
                  </li>
                  <li>
                    <a href="#widget-api" class="toc-h2 toc-link" data-title="Widget API">Widget API</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#webhooks" class="toc-h1 toc-link" data-title="Webhooks">Webhooks</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#universal-webhook" class="toc-h2 toc-link" data-title="Universal Webhook">Universal Webhook</a>
                  </li>
                  <li>
                    <a href="#other-webhooks" class="toc-h2 toc-link" data-title="Other Webhooks">Other Webhooks</a>
                  </li>
                  <li>
                    <a href="#webhook-subscriptions" class="toc-h2 toc-link" data-title="Webhook Subscriptions">Webhook Subscriptions</a>
                  </li>
                  <li>
                    <a href="#retry-policy" class="toc-h2 toc-link" data-title="Retry Policy">Retry Policy</a>
                  </li>
                  <li>
                    <a href="#get-the-latest-reservation-status" class="toc-h2 toc-link" data-title="Get the latest reservation status">Get the latest reservation status</a>
                  </li>
              </ul>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href='https://www.ranchbookings.com/partners/register'>Register as a partner</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>The purpose of this document is to document how to build an application on the Check-in Sherpa Platform.</p>

<p>All URIs are given as relative paths to the domain you are interfacing with:</p>

<ul>
<li>  Staging: staging.ranchbookings.com</li>
<li>  Production: www.ranchbookings.com</li>
</ul>

<p>We list what each endpoint is used for and which field, if any, is an input to any other endpoint or widget.</p>
<h1 id='registering-as-a-partner'>Registering as a Partner</h1>
<p>Before you are able to register an application, you need a partner account.</p>

<p>The Registration page is at <a href="https://staging.ranchbookings.com/partners/register/">/partners/register</a></p>

<p>Fill in the required information, and click the validation link in the email you receive.</p>

<p>Then you may login at /accounts/login</p>

<p>For the staging environment, we have a user already created and activated:</p>

<ul>
<li>  Login at <a href="https://staging.ranchbookings.com/accounts/login">https://staging.ranchbookings.com/accounts/login</a></li>
<li>  Username: test_partner</li>
<li>  Password: password</li>
</ul>
<h1 id='creating-an-application'>Creating an application</h1>
<p>Register an application at <a href="https://staging.ranchbookings.com/o/applications/register/">/o/applications/register/</a></p>

<ul>
<li>  <strong>Logo</strong>: an image to be displayed to end-users authorizing your application on their account. Size is 100px by 100px</li>
<li>  <strong>Name and Description</strong>: displayed to end-users so they can identify your app</li>
<li>  <strong>Websites</strong>: a list of websites where you will display the calendar, as full URLs, space separated. They must be secured websites (start with https). <strong>You will not be able to embed the booking widget on any website not listed here.</strong></li>
<li>  <strong>Api Access</strong>: if you are not a developer and will only use booking links/widgets, you do not need API Access. Leave this unchecked and we&#39;ll take care of authorization for you. If you do enable API Access, you get access to two more settings:</li>
<li>  <strong>Redirect URIs</strong>: space separated list of allowed URIs you control for post-auth redirect.</li>
<li>  <strong>Universal Webhook URL</strong>: endpoint where Check-in Sherpa will send change notifications for reservations you &quot;own&quot;. You can subscribe to webhooks for individual resorts on your own; but this makes it much more convenient as the subscription gets created automatically upon a resort joining your app.</li>
</ul>

<p>Once you save your application, you are redirected to a page where you can see your client_id and client_secret.</p>
<h1 id='obtaining-an-access-token'>Obtaining an Access Token</h1>
<p>We implement the standard <a href="https://oauth.net/2/grant-types/authorization-code/">OAuth2.0 authorization code flow.</a></p>

<p>Here is a <a href="https://developer.okta.com/blog/2018/04/10/oauth-authorization-code-grant-type">detailed guide</a>.</p>

<p>The URIs for the flow are:</p>

<ul>
<li>  Authorization Page at /o/authorize/ - used to build the URL where you request access from one of our users.</li>
<li>  Token Exchange Endpoint at /o/token/ - used to send a post request to obtain your access token</li>
</ul>

<p>Here is an end-user account for the staging environment so you can test the whole flow:</p>

<ul>
<li>  Login at <a href="https://staging.ranchbookings.com/accounts/login">https://staging.ranchbookings.com/accounts/login</a></li>
<li>  Username: admin</li>
<li>  Password: password</li>
</ul>
<h1 id='using-your-access-token-for-api-queries'>Using your Access Token for API queries</h1>
<p>When sending requests, add a header:</p>

<ul>
<li>  Key: “Authorization”</li>
<li>  Value: “Bearer {{ your access token }}”</li>
</ul>
<h1 id='retrieving-resort-information'>Retrieving resort information</h1>
<p><strong>Purpose:</strong></p>

<ul>
<li>  <strong>Embedding our booking widget</strong> using the slug_name</li>
<li>  <strong>Building your own widget</strong> using the resort general information and booking policies</li>
</ul>
<h3 id='http-request'>HTTP Request</h3>
<p><code>GET /partners/property-info/</code></p>
<h3 id='query-parameters'>Query Parameters</h3>
<p>None</p>
<h3 id='response-body'>Response Body</h3>
<blockquote>
<p>The json response looks like this:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
</span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pitchfork Ranch"</span><span class="p">,</span><span class="w"> 
</span><span class="nl">"slug_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pitchfork-ranch"</span><span class="p">,</span><span class="w">
</span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"public_email@example.com"</span><span class="p">,</span><span class="w">
</span><span class="nl">"user_email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"private_email@example.com"</span><span class="p">,</span><span class="w">
</span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Property address"</span><span class="p">,</span><span class="w">
</span><span class="nl">"website"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://pitchforkranch.example.com"</span><span class="p">,</span><span class="w">
</span><span class="nl">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"public phone number"</span><span class="p">,</span><span class="w">
</span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Property description"</span><span class="p">,</span><span class="w">
</span><span class="nl">"policies_page"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://pitchforkranch.example.com/policies"</span><span class="p">,</span><span class="w">
</span><span class="nl">"deposit_percentage"</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w">
</span><span class="nl">"balance_due"</span><span class="p">:</span><span class="w"> </span><span class="mi">45</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>String</td>
<td>The name of the property</td>
</tr>
<tr>
<td>slug_name</td>
<td>String</td>
<td>Slugified name of the property - useful especially when embedding the booking widget</td>
</tr>
<tr>
<td>email</td>
<td>String</td>
<td>General email address of the property - where they wish guests to email them</td>
</tr>
<tr>
<td>user_email</td>
<td>String</td>
<td>Email address of the Check-in Sherpa user who gave access</td>
</tr>
<tr>
<td>address</td>
<td>String</td>
<td>Property address</td>
</tr>
<tr>
<td>website</td>
<td>String</td>
<td>Property website URL</td>
</tr>
<tr>
<td>phone</td>
<td>String</td>
<td>Property phone number - for guests</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Property description</td>
</tr>
<tr>
<td>policies_page</td>
<td>String</td>
<td>URL of the page on their website that has booking policies</td>
</tr>
<tr>
<td>deposit_percentage</td>
<td>Integer</td>
<td>% of reservation total required for initial deposit</td>
</tr>
<tr>
<td>balance_due</td>
<td>Integer</td>
<td># days prior to arrival when balance becomes dues. 0 means balance is due at check-out</td>
</tr>
</tbody></table>
<h1 id='building-your-own-widget'>Building your own widget</h1>
<p>The following endpoints are required to build your own calendar widget. If you are embedding our widget, <a href="#embedding-our-widget">skip ahead</a></p>
<h2 id='package-list'>Package List</h2><h3 id='http-request'>HTTP Request</h3>
<p><code>GET /partners/packages/</code></p>
<h3 id='query-parameters'>Query Parameters</h3>
<p>None</p>
<h3 id='response-body'>Response Body</h3>
<blockquote>
<p>The json response looks like this:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Package Name"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Package Description"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"nights"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
    </span><span class="nl">"weekdays_arrival"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">],</span><span class="w">
    </span><span class="nl">"seasons"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w">
</span><span class="p">},</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">more</span><span class="w"> </span><span class="err">packages</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Integer</td>
<td>The package&#39;s id</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The package&#39;s name</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>The package&#39;s description</td>
</tr>
<tr>
<td>nights</td>
<td>Integer</td>
<td>Number of nights the guest will spend at the property</td>
</tr>
<tr>
<td>weekdays_arrival</td>
<td>[Integer]</td>
<td>list of weekdays allowed for check-in, 0 is Monday.</td>
</tr>
<tr>
<td>seasons</td>
<td>[Integer]</td>
<td>list of season ids during which the package is offered at some point; it may only be offered part of that season, though.</td>
</tr>
</tbody></table>
<h2 id='age-discounts-list'>Age Discounts List</h2><h3 id='http-request'>HTTP Request</h3>
<p><code>GET /partners/agediscounts/</code></p>
<h3 id='query-parameters'>Query Parameters</h3>
<p>None</p>
<h3 id='response-body'>Response Body</h3>
<blockquote>
<p>The json response looks like this:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"policy"</span><span class="p">:</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nl">"min_age"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"max_age"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
        </span><span class="nl">"verbose"</span><span class="p">:</span><span class="w"> </span><span class="s2">"from age 0 (inclusive) to 2"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"listings"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
        </span><span class="nl">"price_dollars"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nl">"price_percent"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-100.00"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"package"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nl">"verbose"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100.00% off"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="err">//</span><span class="w"> </span><span class="err">more</span><span class="w"> </span><span class="err">listings</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">},</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">more</span><span class="w"> </span><span class="err">discounts</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p>Age Discounts objects comprise a <code>policy</code> object which determines whether a guest is eligible to a discount, and one or more <code>listing</code> objects which determine the amount of the discount, based on the package the guest is booking.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>policy</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>id</td>
<td>Integer</td>
<td>The policy&#39;s id</td>
</tr>
<tr>
<td>min_age</td>
<td>Integer</td>
<td>Minimum age at arrival to be eligible for the discount, <strong>inclusive</strong></td>
</tr>
<tr>
<td>max_age</td>
<td>Integer</td>
<td>Maximum age at arrival to be eligible for the discount, <strong>exclusive</strong></td>
</tr>
<tr>
<td>verbose</td>
<td>String</td>
<td>A verbose representation of the policy terms</td>
</tr>
<tr>
<td><strong>listings</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>id</td>
<td>Integer</td>
<td>The listing&#39;s id</td>
</tr>
<tr>
<td>price_dollars</td>
<td>Integer or null</td>
<td>The negative amount, in dollars, of the discount; will be null if the discount is percentage based</td>
</tr>
<tr>
<td>price_percent</td>
<td>Integer or null</td>
<td>The negative percentage, in dollars, of the discount; will be null if the discount is dollar based</td>
</tr>
<tr>
<td>package</td>
<td>Integer or null</td>
<td>If null, this is the default listing; otherwise, this is the id of the package the listing applies to. Package specific listings supercede the default.</td>
</tr>
<tr>
<td>verbose</td>
<td>String</td>
<td>A verbose representation of the listing</td>
</tr>
</tbody></table>
<h2 id='seasons-list'>Seasons List</h2><h3 id='http-request'>HTTP Request</h3>
<p><code>GET /partners/seasons/</code></p>
<h3 id='query-parameters'>Query Parameters</h3>
<p>None</p>
<h3 id='response-body'>Response Body</h3>
<blockquote>
<p>The json response looks like this:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Season Name"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"dates"</span><span class="p">:</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"start_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-06-07"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"end_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-20"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">},</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">more</span><span class="w"> </span><span class="err">seasons</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Integer</td>
<td>The season&#39;s id</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The season&#39;s name</td>
</tr>
<tr>
<td><strong>dates</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>start_date</td>
<td>String</td>
<td>The date the season starts in YYYY-MM-DD format</td>
</tr>
<tr>
<td>end_date</td>
<td>String</td>
<td>The date the season ends in YYYY-MM-DD format</td>
</tr>
</tbody></table>
<h2 id='availability-data'>Availability Data</h2><h3 id='http-request'>HTTP Request</h3>
<p><code>GET /partners/availability/list/</code></p>
<h3 id='query-parameters'>Query Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>season_id</td>
<td>Integer</td>
<td>Yes</td>
<td>The id of the season for which you are requesting availability data</td>
</tr>
</tbody></table>
<h3 id='response-body'>Response Body</h3>
<blockquote>
<p>The json response looks like this:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Room name"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"max_occupancy"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
  </span><span class="nl">"room_numbers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w">
  </span><span class="nl">"availability"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
      </span><span class="nl">"date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-06-07"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"available"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nl">"available_numbers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="err">//</span><span class="w"> </span><span class="err">More</span><span class="w"> </span><span class="err">availability</span><span class="w"> </span><span class="err">deltas</span><span class="w">
</span><span class="err">}</span><span class="p">,</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">More</span><span class="w"> </span><span class="err">rooms</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Integer</td>
<td>The room type&#39;s id</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The room type&#39;s name</td>
</tr>
<tr>
<td>max_occupancy</td>
<td>Integer</td>
<td>The maximum number of guests that can occupy the room</td>
</tr>
<tr>
<td>room_numbers</td>
<td>[Integer]</td>
<td>Each room of this type has its own room number</td>
</tr>
<tr>
<td><strong>availability</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>date</td>
<td>String</td>
<td>The date for the availability change, in YYYY-MM-DD format</td>
</tr>
<tr>
<td>available</td>
<td>Integer</td>
<td>The number of rooms of this time that are available on that date</td>
</tr>
<tr>
<td>available_numbers</td>
<td>[Integer]</td>
<td>The room numbers of the rooms that are available</td>
</tr>
</tbody></table>
<h2 id='pricing-data'>Pricing Data</h2><h3 id='http-request'>HTTP Request</h3>
<p><code>GET /partners/pricing/</code></p>
<h3 id='query-parameters'>Query Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>season_id</td>
<td>Integer</td>
<td>Yes</td>
<td>The id of the season for which you are requesting availability data</td>
</tr>
<tr>
<td>nights</td>
<td>Integer</td>
<td>Yes</td>
<td>The length of stay you are requesting pricing data for; must correspond to the length of a package that is available during the season</td>
</tr>
</tbody></table>
<h3 id='response-body'>Response Body</h3>
<blockquote>
<p>The json response looks like this:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"start_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-06-07"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"end_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-06-20"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"weekdays_arrival"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">],</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">i.e</span><span class="p">,</span><span class="w"> </span><span class="err">Wednesday</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">Sunday</span><span class="w">
  </span><span class="nl">"low_price"</span><span class="p">:</span><span class="w">
  </span><span class="p">{</span><span class="w">
      </span><span class="nl">"2"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"1400.00"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1300.00"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1200.00"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1100.00"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1000.00"</span><span class="p">],</span><span class="w">
      </span><span class="nl">"6"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"1200.00"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1200.00"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1200.00"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1100.00"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1000.00"</span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
</span><span class="p">},</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">more</span><span class="w"> </span><span class="err">pricing</span><span class="w"> </span><span class="err">periods</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>start_date</td>
<td>String</td>
<td>The date the pricing period starts, in YYYY-MM-DD format</td>
</tr>
<tr>
<td>end_date</td>
<td>String</td>
<td>The date the pricing period ends, in YYYY-MM-DD format</td>
</tr>
<tr>
<td>weekdays_arrival</td>
<td>[Integer]</td>
<td>The list of (integer formatted, 0 is Monday) weekdays that are available to check-in for the length of stay you requested</td>
</tr>
<tr>
<td>low_price</td>
<td>{String: [String]}</td>
<td>A dictionary that maps the weekday of arrival to the pricing data.</td>
</tr>
</tbody></table>

<p>The purpose of this endpoint is to enable you to give a <strong>cheapest rate available estimate</strong> during the early stages of the reservation process; final price will often be different, based on which accomodations are selected.</p>

<p>Rates should be read as the price per person for the entire length of the stay, <strong>not</strong> the nightly rate for the whole room like traditional accommodation.</p>

<p>For each available weekday, you get a list of the cheapest rates available to accommodate various size parties in a single room:</p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="nl">"2"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"1400.00"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1300.00"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1200.00"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1100.00"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1000.00"</span><span class="p">]</span><span class="err">,</span><span class="w">
</span></code></pre></div>
<p>The json on the right means that for Wednesday check-ins,</p>

<table><thead>
<tr>
<th># in party</th>
<th>Cheapest rate to show</th>
</tr>
</thead><tbody>
<tr>
<td>1</td>
<td>from $1400/person</td>
</tr>
<tr>
<td>2</td>
<td>from $1300/person</td>
</tr>
<tr>
<td>3</td>
<td>from $1200/person</td>
</tr>
<tr>
<td>4</td>
<td>from $1100/person</td>
</tr>
<tr>
<td>5</td>
<td>from $1000/person</td>
</tr>
<tr>
<td>6+</td>
<td>from $1000/person (i.e. the minimum rate in the list)</td>
</tr>
</tbody></table>
<h2 id='inquiry-creation'>Inquiry Creation</h2><h3 id='http-request'>HTTP Request</h3>
<p><code>POST /partners/inquiry/</code></p>
<h3 id='request-body'>Request Body</h3>
<blockquote>
<p>The json request looks like this:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"inquired_for_adults"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nl">"inquired_for_kids"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"arrival_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-05-04"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"departure_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-05-06"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"customer"</span><span class="p">:</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Customer Name"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"customeremail@example.com"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(123)456-7890"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"address_line1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Address line 1"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"address_line2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Address line 2"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"City"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"zip"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12345"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Wyoming"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"United States"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>inquired_for_adults</td>
<td>Integer</td>
<td>Yes</td>
<td>Number of adults in party</td>
</tr>
<tr>
<td>inquired_for_kids</td>
<td>Integer</td>
<td>Yes</td>
<td>Number of kids in party - usual quoting process then requests the birth dates; we may have to move that in this endpoint</td>
</tr>
<tr>
<td>arrival_date</td>
<td>String</td>
<td>Yes</td>
<td>&#39;YYYY-MM-DD&#39; formatted arrival date, must be in season.</td>
</tr>
<tr>
<td>departure_date</td>
<td>String</td>
<td>Yes</td>
<td>&#39;YYYY-MM-DD&#39; formatted departure date.</td>
</tr>
<tr>
<td><strong>customer</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>Yes</td>
<td>The customer&#39;s name (required)</td>
</tr>
<tr>
<td>email</td>
<td>String</td>
<td>Yes</td>
<td>The customer&#39;s email address (required</td>
</tr>
<tr>
<td>phone</td>
<td>String</td>
<td>Yes</td>
<td>The customer&#39;s phone number</td>
</tr>
<tr>
<td>address_line1</td>
<td>String</td>
<td>No</td>
<td>The customer&#39;s address line #1</td>
</tr>
<tr>
<td>address_line2</td>
<td>String</td>
<td>No</td>
<td>The customer&#39;s address line #1</td>
</tr>
<tr>
<td>city</td>
<td>String</td>
<td>No</td>
<td>The customer&#39;s city</td>
</tr>
<tr>
<td>zip</td>
<td>String</td>
<td>No</td>
<td>The customer&#39;s zip code</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>No</td>
<td>The customer&#39;s state if in US/Canada</td>
</tr>
<tr>
<td>country</td>
<td>String</td>
<td>No</td>
<td>The customer&#39;s country</td>
</tr>
</tbody></table>
<h3 id='response-body'>Response Body</h3>
<blockquote>
<p>The json response looks like this:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"inquired_for_adults"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nl">"inquired_for_kids"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"arrival_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-05-04"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"departure_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-05-06"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"customer"</span><span class="p">:</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Customer Name"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"customeremail@example.com"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(123)456-7890"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"address_line1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Address line 1"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"address_line2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Address line 2"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"City"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"zip"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12345"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Wyoming"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"United States"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>The response contains the data you have submitted, + the reservation and customer id.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Integer</td>
<td>The reservation number</td>
</tr>
<tr>
<td>inquired_for_adults</td>
<td>Integer</td>
<td>Number of adults in party</td>
</tr>
<tr>
<td>inquired_for_kids</td>
<td>Integer</td>
<td>Number of kids in party - usual quoting process then requests the birth dates; we may have to move that in this endpoint</td>
</tr>
<tr>
<td>arrival_date</td>
<td>String</td>
<td>&#39;YYYY-MM-DD&#39; formatted arrival date, must be in season.</td>
</tr>
<tr>
<td>departure_date</td>
<td>String</td>
<td>&#39;YYYY-MM-DD&#39; formatted departure date.</td>
</tr>
<tr>
<td><strong>customer</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>id</td>
<td>Integer</td>
<td>The customer id</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>The customer&#39;s name (required)</td>
</tr>
<tr>
<td>email</td>
<td>String</td>
<td>The customer&#39;s email address (required</td>
</tr>
<tr>
<td>phone</td>
<td>String</td>
<td>The customer&#39;s phone number</td>
</tr>
<tr>
<td>address_line1</td>
<td>String</td>
<td>The customer&#39;s address line #1</td>
</tr>
<tr>
<td>address_line2</td>
<td>String</td>
<td>The customer&#39;s address line #1</td>
</tr>
<tr>
<td>city</td>
<td>String</td>
<td>The customer&#39;s city</td>
</tr>
<tr>
<td>zip</td>
<td>String</td>
<td>The customer&#39;s zip code</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>The customer&#39;s state if in US/Canada</td>
</tr>
<tr>
<td>country</td>
<td>String</td>
<td>The customer&#39;s country</td>
</tr>
</tbody></table>
<h1 id='embedding-our-widget'>Embedding Our Widget</h1>
<p>Instead of implementing your own booking calendar, you can embed our booking widget.
Once you have <a href="#creating-an-application">registered an application</a> and <a href="#obtaining-an-access-token">obtained authorization from a resort</a>, you can embed their booking calendar using your app&#39;s Client Id and the resort&#39;s Slug Name that you can obtain via <a href="#retrieving-resort-information">the resort information endpoint</a>.</p>
<h2 id='loading-the-widget'>Loading the widget</h2>
<p>Execute the javascript on the right side in a &lt;script&gt; tag near the top of the &lt;head&gt; tag.
<strong>Make sure to replace &lt;&lt;DOMAIN&gt;&gt; with <a href="#introduction">the right domain</a>.</strong></p>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="nx">h</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">p</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">l</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">s</span><span class="p">[</span><span class="dl">'</span><span class="s1">SherpaWidget</span><span class="dl">'</span><span class="p">]</span><span class="o">=</span><span class="nx">r</span><span class="p">;</span><span class="nx">s</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span> <span class="o">=</span> <span class="nx">s</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span> <span class="o">||</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">q</span> <span class="o">=</span> <span class="nx">s</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">q</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span> <span class="p">};</span>
    <span class="nx">a</span> <span class="o">=</span> <span class="nx">h</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">e</span><span class="p">),</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">h</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">e</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    <span class="nx">a</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">r</span><span class="p">;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">p</span><span class="p">;</span> <span class="nx">a</span><span class="p">.</span><span class="k">async</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">l</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">l</span><span class="p">);</span>
<span class="p">}(</span><span class="nb">window</span><span class="p">,</span> <span class="nb">document</span><span class="p">,</span> <span class="dl">'</span><span class="s1">script</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">sherpa</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">https://&lt;&lt;DOMAIN&gt;&gt;/widget.js</span><span class="dl">'</span><span class="p">));</span>
</code></pre></div><h2 id='widget-api'>Widget API</h2>
<p>The widget supports two functions:</p>

<ul>
<li><strong>init</strong> configures the widget</li>
<li><strong>render</strong> renders the widget; any argument passed will override any configurations from <strong>init</strong> or any defaults</li>
</ul>

<p><strong>init</strong> is mostly useful to avoid code repetition if you call <strong>render</strong> several times per page load, i.e. in the context of a Single Page Application.</p>

<blockquote>
<p>Here are a couple example calls:</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="nx">sherpa</span><span class="p">(</span><span class="dl">'</span><span class="s1">init</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">clientId</span><span class="p">:</span> <span class="dl">"</span><span class="s2">abcdef</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">containerId</span><span class="p">:</span> <span class="dl">"</span><span class="s2">myContainer</span><span class="dl">"</span>
<span class="p">})</span>

<span class="nx">sherpa</span><span class="p">(</span><span class="dl">'</span><span class="s1">render</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">resortSlug</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ExampleResort</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">modalButtons</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="dl">"</span><span class="s2">myButtonClass</span><span class="dl">"</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div>
<p>Below are the arguments supported by those functions</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>clientId</td>
<td>String</td>
<td>Yes</td>
<td>Your app&#39;s client id, so we can identify you have access to the resort&#39;s calendar</td>
</tr>
<tr>
<td>resortSlug</td>
<td>String</td>
<td>Yes</td>
<td>The resort&#39;s &quot;slug name&quot; obtained via <a href="#retrieving-resort-information">the resort information endpoint</a>.</td>
</tr>
<tr>
<td>containerId</td>
<td>String</td>
<td>No</td>
<td>The id for the &lt;div&gt; element where you would like the calendar to be rendered. Defaults to &quot;sherpacontainer&quot;. If not found, will create the &lt;div&gt;.</td>
</tr>
<tr>
<td>modalButtons</td>
<td>HTMLCollection</td>
<td>No</td>
<td>If undefined, will attempt to retrieve all elements with the &quot;sherpa-modal-button&quot; class. If some buttons are passed-in or found via the default class, the calendar widget will load in a modal when clicking those buttons. If no buttons are found, the calendar will be rendered right in the container.</td>
</tr>
</tbody></table>
<h1 id='webhooks'>Webhooks</h1><h2 id='universal-webhook'>Universal Webhook</h2>
<p>The universal webhook fires on any change to a reservation you own (including related resource changes such as customer, invoice and payments).</p>

<p>The payload you receive contains:</p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"signature"</span><span class="p">:</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1600876661</span><span class="p">,</span><span class="w">
        </span><span class="nl">"token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9d6bdaa2-fcd0-415a-8a6d-d5c3356cbde4"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"signature"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c60f7704417c09d7b07fe2a371b5d946323205ed1ecce3c11af7d546f3c4d510"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">12345</span><span class="p">,</span><span class="w">
    </span><span class="nl">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"order_new"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"resort"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pitchfork Ranch"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"slug_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pitchfork-ranch"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<ul>
<li>  An object named ‘signature’ you will be able to use to verify the request is coming from us</li>
<li>  The Id of the reservation that changed, so you can send a query to the Reservation Status endpoint and get the latest info.</li>
<li>  The event that caused the webhook to fire</li>
<li>  The resort which the reservation belongs to, so you can use the right access token when calling into the api to get the data.</li>
</ul>

<p>The &#39;signature&#39; object contains:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>timestamp</td>
<td>Integer</td>
<td>Number of seconds passed since January 1, 1970.</td>
</tr>
<tr>
<td>token</td>
<td>String</td>
<td>a randomly generated string of 36 characters (a version 4 UUID)</td>
</tr>
<tr>
<td>signature</td>
<td>String</td>
<td>String of hexadecimal digits generated by the HMAC algorithm</td>
</tr>
</tbody></table>
<h3 id='securing-the-universal-webhook'>Securing the Universal Webhook</h3><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">hashlib</span><span class="p">,</span> <span class="n">hmac</span>

<span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="n">client_secret</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">signature</span><span class="p">):</span>
    <span class="n">hmac_digest</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">client_secret</span><span class="p">.</span><span class="n">encode</span><span class="p">(),</span>
                           <span class="n">msg</span><span class="o">=</span><span class="p">(</span><span class="s">'{}{}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">token</span><span class="p">)).</span><span class="n">encode</span><span class="p">(),</span>
                           <span class="n">digestmod</span><span class="o">=</span><span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">hmac</span><span class="p">.</span><span class="n">compare_digest</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">signature</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">hmac_digest</span><span class="p">))</span>
</code></pre></div><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="nb">require</span> <span class="s1">'openssl'</span>

<span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="n">client_secret</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">signature</span><span class="p">)</span>
  <span class="n">digest</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Digest</span><span class="o">::</span><span class="no">SHA256</span><span class="p">.</span><span class="nf">new</span>
  <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">token</span><span class="p">].</span><span class="nf">join</span>
  <span class="n">signature</span> <span class="o">==</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">HMAC</span><span class="p">.</span><span class="nf">hexdigest</span><span class="p">(</span><span class="n">digest</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">verify</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">clientSecret</span><span class="p">,</span> <span class="nx">timestamp</span><span class="p">,</span> <span class="nx">token</span><span class="p">,</span> <span class="nx">signature</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">encodedToken</span> <span class="o">=</span> <span class="nx">crypto</span>
        <span class="p">.</span><span class="nx">createHmac</span><span class="p">(</span><span class="dl">'</span><span class="s1">sha256</span><span class="dl">'</span><span class="p">,</span> <span class="nx">clientSecret</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">timestamp</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">token</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="nx">encodedToken</span> <span class="o">===</span> <span class="nx">signature</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>To generate the signature for comparison against the one we sent along, you need to:</p>

<ul>
<li>Concatenate the timestamp and token.</li>
<li>Encode that message with the HMAC algorithm, using your application&#39;s Client Secret as the key and SHA256 as the digest mode.</li>
<li>Compare that hexdigest to the signature.</li>
</ul>

<p>Consider caching the token value locally and not honoring any subsequent request with the same token to protect against replay attacks.</p>
<h2 id='other-webhooks'>Other Webhooks</h2>
<p>We created the following webhooks to power our Zapier integration. For third party developers, we recommend using the Universal Webhook, but those webhooks are supported if for whatever reason you prefer using them.</p>
<h3 id='the-order-webhooks'>The Order Webhooks</h3>
<blockquote>
<p>Example Order Webhook Payload</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">33025</span><span class="p">,</span><span class="w">
  </span><span class="nl">"resort"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The Best Ranch In The WORLD"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"slug_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"TheBestRanchInTheWORLD"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"package"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6 Nights"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"rooms"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"room_type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cowboy"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"twin_beds"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
        </span><span class="nl">"full_beds"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"queen_beds"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nl">"king_beds"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"room_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cowboy"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"room_number"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
      </span><span class="nl">"number_occupants"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
      </span><span class="nl">"created_on"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-03T17:14:17.230Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"modified_on"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-03T17:14:17.230Z"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"invoice"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4 guests in room Cowboy"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
      </span><span class="nl">"unit_price"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1931.44"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"unit_tax"</span><span class="p">:</span><span class="w"> </span><span class="s2">"424.67"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9424.44"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"created_on"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-03T17:14:17.351Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"modified_on"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-03T17:14:17.351Z"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"payments"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Full payment for your stay at Demo Ranch"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7068.33"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"is_cash"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"refunded"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"amount_refunded"</span><span class="p">:</span><span class="w"> </span><span class="s2">"500.00"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"net_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6568.33"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"created_on"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-03T17:18:07.813Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"modified_on"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-03T17:18:07.813Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"succeeded"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Visa 1111"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"refunds"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"500.00"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"created_on"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-03-26T17:41:54.545Z"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"modified_on"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-03-26T17:41:54.545Z"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Fully Paid"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"customer"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">31923</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Matthieu Corrand"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"matt@ranchbookings.com,steve@ranchbookings.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3074132324"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"address_line1"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nl">"address_line2"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nl">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nl">"zip"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nl">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nl">"created_on"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-03T17:18:05.749Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"modified_on"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-03T17:25:34.030Z"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"arrival_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-06"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"departure_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-12"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"created_on"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-03T17:14:17.225Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"modified_on"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-03T17:18:07.847Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><code>order_new</code> and <code>order_update</code> will fire for new and updated reservations respectively.
The payload contains the reservation details and associated resources.</p>
<h3 id='the-customer-webhooks'>The Customer Webhooks</h3>
<blockquote>
<p>Example Customer Webhook Payload</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">31923</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Matthieu Corrand"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"matt@ranchbookings.com,steve@ranchbookings.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3074132324"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"address_line1"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"address_line2"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"zip"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"created_on"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-03T17:18:05.749Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"modified_on"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-03T17:25:34.030Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><code>customer_new</code> and <code>customer_update</code> will fire for new and updated customers respectively.
The payload contains the customer information.</p>
<h3 id='the-payment-webhooks'>The Payment Webhooks</h3>
<blockquote>
<p>Example Payment Webhook Payload</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Payment for reservation at Demo Ranch"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1000.00"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"is_cash"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"refunded"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"amount_refunded"</span><span class="p">:</span><span class="w"> </span><span class="s2">"500.00"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"net_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"500.00"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"created_on"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-03-26T17:33:30.087Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"modified_on"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-03-26T17:41:54.542Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"succeeded"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cash/Check"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"refunds"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"500.00"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"created_on"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-03-26T17:41:54.545Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"modified_on"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-03-26T17:41:54.545Z"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><code>payment_new</code> and <code>payment_update</code> will fire for new and updated (refunded) payments respectively.
The payload contains the payment information.</p>
<h2 id='webhook-subscriptions'>Webhook Subscriptions</h2>
<p>Webhook URLs are required to be unique within each resort; i.e you can use <code>https://www.mydomain.com/webhook-handler/order_new</code> to handle the <code>order_new</code> webhook of many resorts; but you cannot use <code>https://www.mydomain.com/webhook-handler/</code> for both the <code>universal</code> webhook and the <code>order_new</code> webhook of a single resort.</p>
<h3 id='using-the-universal-webhook-url-setting'>Using the Universal Webhook URL setting</h3>
<p>If you set the Universal Webhook URL setting on your application, a new Webhook Subscription for the Universal Webhook will automatically be created for each resort which enables your application.
This saves you from having to manage webhook subscriptions individually via the api. Combined with the more streamlined payload of the universal webhook, this is our recommended way of setting up Webhooks.</p>
<h3 id='using-the-api-to-create-a-webhook-subscription'>Using the API to create a Webhook Subscription</h3>
<p>You can subscribe to specific webhooks for a resort via the API; it requires <a href="#using-your-access-token-for-api-queries">authenticating your request</a>. </p>
<h4 id='http-request'>HTTP Request</h4>
<p><code>POST /partners/webhooks/</code></p>
<h4 id='request-body'>Request Body</h4>
<blockquote>
<p>The json request looks like this:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"order_new"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.domain.com/webhook-handler"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td>The type of webhook to subscribe to. Available choices are <code>order_new</code>, <code>order_update</code>, <code>customer_new</code>, <code>customer_update</code>, <code>payment_new</code>, <code>payment_update</code> and <code>universal</code>.</td>
</tr>
<tr>
<td>url</td>
<td>String</td>
<td>Yes</td>
<td>The URL where we should POST the webhook.</td>
</tr>
</tbody></table>

<p>You can also list all your subscriptions for a resort by issuing a <code>GET</code> request to this endpoint.</p>
<h3 id='unsubscribing-from-a-webhook'>Unsubscribing from a Webhook</h3><h4 id='http-request-2'>HTTP Request</h4>
<p><code>DELETE /partners/webhooks/</code></p>
<h4 id='request-body-2'>Request Body</h4>
<blockquote>
<p>The json request looks like this:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.domain.com/webhook-handler"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>url</td>
<td>String</td>
<td>Yes</td>
<td>The URL for the webhook you want to unsubscribe from for that resort.</td>
</tr>
</tbody></table>
<h2 id='retry-policy'>Retry Policy</h2>
<blockquote>
<p>using the formula </p>

<p><code>(retry_count ** 4) + 15 + (randint(0, 30) * (retry_count + 1))</code> </p>
</blockquote>

<p>If we are not successful in sending a webhook (we receive a 4xx or 5xx status code from your server or our request times out), we will retry up to 15 times with an <strong>exponential backoff</strong> (i.e. 15, 16, 31, 96, 271, ... seconds + a <a href="https://github.com/mperham/sidekiq/issues/480">random amount of time</a>).</p>

<p>The 15 retries will be performed in approximately 36 hours. Please note: we will retry sending to the same URL as our first attempt; changing the url of your webhook will not be reflected in retry attempts.</p>

<p>This table contains approximate retry waiting time.</p>

<table><thead>
<tr>
<th>#</th>
<th>Next retry backoff</th>
<th>Total waiting time</th>
</tr>
</thead><tbody>
<tr>
<td>1</td>
<td>0d  0h  0m 30s</td>
<td>0d  0h  0m 30s</td>
</tr>
<tr>
<td>2</td>
<td>0d  0h  0m 46s</td>
<td>0d  0h  1m 16s</td>
</tr>
<tr>
<td>3</td>
<td>0d  0h  1m 16s</td>
<td>0d  0h  2m 32s</td>
</tr>
<tr>
<td>4</td>
<td>0d  0h  2m 36s</td>
<td>0d  0h  5m  8s</td>
</tr>
<tr>
<td>5</td>
<td>0d  0h  5m 46s</td>
<td>0d  0h 10m 54s</td>
</tr>
<tr>
<td>6</td>
<td>0d  0h 12m 10s</td>
<td>0d  0h 23m  4s</td>
</tr>
<tr>
<td>7</td>
<td>0d  0h 23m 36s</td>
<td>0d  0h 46m 40s</td>
</tr>
<tr>
<td>8</td>
<td>0d  0h 42m 16s</td>
<td>0d  1h 28m 56s</td>
</tr>
<tr>
<td>9</td>
<td>0d  1h 10m 46s</td>
<td>0d  2h 39m 42s</td>
</tr>
<tr>
<td>10</td>
<td>0d  1h 52m  6s</td>
<td>0d  4h 31m 48s</td>
</tr>
<tr>
<td>11</td>
<td>0d  2h 49m 40s</td>
<td>0d  7h 21m 28s</td>
</tr>
<tr>
<td>12</td>
<td>0d  4h  7m 16s</td>
<td>0d 11h 28m 44s</td>
</tr>
<tr>
<td>13</td>
<td>0d  5h 49m  6s</td>
<td>0d 17h 17m 50s</td>
</tr>
<tr>
<td>14</td>
<td>0d  7h 59m 46s</td>
<td>1d  1h 17m 36s</td>
</tr>
<tr>
<td>15</td>
<td>0d 10h 44m 16s</td>
<td>1d 12h  1m 52s</td>
</tr>
</tbody></table>

<p>This table was calculated under the assumption that <code>randint(0, 30)</code> always returns 15.</p>
<h2 id='get-the-latest-reservation-status'>Get the latest reservation status</h2>
<!-- ### HTTP Request -->

<!-- `GET /partners/property-info/` -->

<!-- ### Query Parameters -->

<!-- Parameter | Required | Default | Description -->

<!-- --------- | -------  | ------- | ----------- -->

<!-- ### Response Body -->

<!-- > The json response looks like this: -->

<!-- ```json -->

<!-- { -->

<!-- "name": "Pitchfork Ranch",  -->

<!-- "slug_name": "pitchfork-ranch", -->

<!-- "email": "public_email@example.com", -->

<!-- "user_email": "private_email@example.com", -->

<!-- "address": "Property address", -->

<!-- "website": "https://pitchforkranch.example.com", -->

<!-- "phone": "public phone number", -->

<!-- "description": "Property description", -->

<!-- "policies_page": "https://pitchforkranch.example.com/policies", -->

<!-- "deposit_percentage": 30, -->

<!-- "balance_due": 45 -->

<!-- } -->

<!-- ``` -->

<!-- Key | Type | Description -->

<!-- --------- | ------- | ----------- -->

<!-- name|String|The name of the property  -->

<!-- slug_name|String|Slugified name of the property - useful especially when embedding the booking widget  -->

<!-- email|String|General email address of the property - where they wish guests to email them  -->

<!-- user_email|String|Email address of the Check-in Sherpa user who gave access  -->

<!-- address|String|Property address  -->

<!-- website|String|Property website URL  -->

<!-- phone|String|Property phone number - for guests  -->

<!-- description|String|Property description  -->

<!-- policies_page|String|URL of the page on their website that has booking policies  -->

<!-- deposit_percentage|Integer|% of reservation total required for initial deposit  -->

<!-- balance_due|Integer|# days prior to arrival when balance becomes dues. 0 means balance is due at check-out  -->

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="python">python</a>
                <a href="#" data-language-name="ruby">ruby</a>
                <a href="#" data-language-name="typescript">node</a>
          </div>
      </div>
    </div>
  </body>
</html>
